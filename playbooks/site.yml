---

# -------------------------------------------------------------------------------
# STEP 1: VM Configuration Validation (no VM needed)
# -------------------------------------------------------------------------------
# Validates inventory variables, template names, and resource settings.
- import_playbook: provisioning/vm-operations/test/log-vm-parameters.yml
  tags: [validation, status]

# -------------------------------------------------------------------------------
# STEP 2: vCenter Connectivity Testing (no VM needed)
# -------------------------------------------------------------------------------
# Validates vCenter access, credentials, and API connectivity.
- import_playbook: provisioning/vm-operations/test/connection-parameters.yml
  tags: [validation, vcenter, connectivity]

# -------------------------------------------------------------------------------
# STEP 3: Linux VM Provisioning
# Just doing linux for now
# -------------------------------------------------------------------------------
- import_playbook: provisioning/vm-operations/linux/provision_linux_vm.yml
  tags: [vm-operations, linux]

# -------------------------------------------------------------------------------
# STEP 4: Windows VM Provisioning (Optional)
# -------------------------------------------------------------------------------
# Uncomment to enable Windows VM provisioning.
# - import_playbook: provisioning/vm-operations/windows/provision_windows_vm.yml
#   tags: [vm-operations, windows]

# -------------------------------------------------------------------------------
# STEP 5: Pre-flight Connection Check (VM must exist)
# -------------------------------------------------------------------------------
# Tests SSH, Python, and sudo on the provisioned VM before domain join.
- import_playbook: provisioning/domain-operations/validation/preflight_connection.yml
  tags: [preflight, domain_join]

# -------------------------------------------------------------------------------
# STEP 6: Domain Join
# -------------------------------------------------------------------------------
- import_playbook: provisioning/domain-operations/join_domain/linux/join_linux_vm.yml
  tags: [domain_join, linux]

# -------------------------------------------------------------------------------
# STEP 7: Domain Join Validation (VM must be domain-joined)
# This step takes too long to replicate which in turn take too long to validate
# -------------------------------------------------------------------------------
# Validates domain membership, SSSD, keytab, DNS, and authentication.
#- import_playbook: provisioning/domain-operations/validation/domain_validation.yml
#  tags: [domain_join, domain_validation]

# -------------------------------------------------------------------------------
# STEP 8: Error Handling and Cleanup
# -------------------------------------------------------------------------------
- import_playbook: provisioning/error_handling/cleanup.yml
  tags: [cleanup, error_handling]

