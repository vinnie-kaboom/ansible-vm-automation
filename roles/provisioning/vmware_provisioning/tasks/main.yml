---
# VMware Provisioning Role - Main Task Orchestrator
# Coordinates VM provisioning workflow with separation of concerns

- name: "Pre-flight validation"
  include_tasks: validate.yml
  tags:
    - validation
    - always

- name: "Provision VM in vCenter"
  include_tasks: create_vm.yml
  tags: 
    - provision
    - vm_creation
  when: not (dry_run | default(false) | bool)

- name: "Wait for VMware Tools and customization"
  include_tasks: wait_for_customization.yml
  tags:
    - provision
    - customization
  when: not (dry_run | default(false) | bool)

- name: "Validate network connectivity"
  include_tasks: validate_network.yml
  tags:
    - provision
    - validation
    - network
  when: not (dry_run | default(false) | bool)

- name: "Validate SSH connectivity"
  include_tasks: validate_ssh.yml
  tags:
    - provision
    - validation
    - ssh
  when: 
    - not (dry_run | default(false) | bool)
    - config_validate_ssh | default(true)