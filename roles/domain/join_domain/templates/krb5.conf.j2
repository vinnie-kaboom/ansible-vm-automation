# Kerberos Configuration Template for Domain Join
# Generated by Ansible for Active Directory domain: {{ domain_name }}
# Uses DNS SRV record discovery for KDCs and admin servers.

# To opt out of the system crypto-policies configuration of krb5,
# remove the symlink at /etc/krb5.conf.d/crypto-policies which will not be recreated.
includedir /etc/krb5.conf.d/

[logging]
    default      = FILE:/var/log/krb5libs.log
    kdc          = FILE:/var/log/krb5kdc.log
    admin_server = FILE:/var/log/kadmind.log

[libdefaults]
    default_realm              = {{ domain_name | upper }}
    dns_lookup_realm           = true
    dns_lookup_kdc             = true
    default_domain_suffix      = {{ domain_name }}
    ticket_lifetime            = 24h
    renew_lifetime             = 7d
    forwardable                = true
    rdns                       = false
    pkinit_anchors             = FILE:/etc/pki/tls/certs/ca-bundle.crt
    spake_preauth_groups       = edwards25519
    dns_canonicalize_hostname  = fallback
    qualify_shortname          = ""
    default_ccache_name        = KEYRING:persistent:%{uid}
    udp_preference_limit       = 0

    # For large clock skews with Windows
    max_retries                = 10
    timeout                    = 30

    # Ensure the default_tgs_enctypes includes aes256-cts if your AD uses it
    default_tgs_enctypes       = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 des3-cbc-sha1 arcfour-hmac-md5
    default_tkt_enctypes       = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 des3-cbc-sha1 arcfour-hmac-md5
    permitted_enctypes         = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96 des3-cbc-sha1 arcfour-hmac-md5

[realms]
    CCE3.GPC = {
        # No static KDCs or admin servers - DNS SRV records will provide them.
    }

[domain_realm]
    .{{ domain_name }} = {{ domain_name | upper }}
    {{ domain_name }}  = {{ domain_name | upper }}

