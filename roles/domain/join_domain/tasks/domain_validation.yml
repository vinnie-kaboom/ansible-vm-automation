---

- name: Domain Join Validation
  hosts: "{{ ansible_host | default('all_servers') }}"
  gather_facts: yes
  vars:
    # Use inventory variables directly from group_vars/host_vars
    config_domain_name: "{{ domain_name }}"
    config_domain_realm: "{{ domain_name | upper }}"
    config_domain_ou_linux: "{{ linux_ou | default('') }}"
    config_domain_ou_windows: "{{ windows_ou | default('') }}"
    config_vm_name: "{{ vm_name | default(inventory_hostname) }}"
    config_vm_ip: "{{ ansible_host | default('') }}"
    config_vm_os_type: "linux"
    config_vm_description: "Domain Join Validation"
    config_vm_network_dns_servers: "{{ dns_server | default('') }}"

    # Compute packages based on OS type
    config_domain_join_packages: "realmd,sssd,oddjob-mkhomedir,samba-common-tools,krb5-workstation"

  tasks:
    # OPTIONAL DEBUG OUTPUT - Display configuration for troubleshooting
    # Only executes when debug_mode=true is passed via command line (-e debug_mode=true)
    # Shows loaded configuration values to verify correct settings
    # Output: Displays domain name, admin user, and detected OS type
    - name: Display environment information
      debug:
        msg: |
          Configuration Loaded:
          Domain: {{ config_domain_name | default('NOT_SET') }}
          Admin User: {{ domain_admin_user | default('NOT_SET') }}
          System: {{ ansible_system | default('UNKNOWN') }}
          VM: {{ config_vm_name }} ({{ config_vm_ip }})
      tags: [validation, debug]
      when: debug_mode | default(false) | bool

    # DOMAIN VALIDATION EXECUTION - Run comprehensive domain join verification
    # Automatically detects OS type (Linux/Windows) and runs appropriate validation checks
    # For Linux: Validates realm membership, SSSD status, user authentication
    # For Windows: Validates domain membership, trust relationship, group policy
    # NOTE: join_validation role does not exist yet - commenting out until created
    # - name: Execute domain validation checks
    #   include_role:
    #     name: domain/join_validation
    #   tags: validation
    - name: Domain validation placeholder
      debug:
        msg: "Domain validation role not yet implemented"
      tags: validation



